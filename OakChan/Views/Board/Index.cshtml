@using OakChan.ViewModels;
@model BoardViewModel;
@{
    ViewBag.Title = $"{Model.Board.Key} - Oak chan";
}
@section Scripts{
    <partial name="_ValidationScriptsPartial" />
}
<div class="navbar">
    <a asp-route="default">
        <img src="~/images/home.png" />
        <span>@Localizer["Go to home page"]</span>
    </a>
</div>
<hr />
<h2 class="board-name">@($"/{Model.Board.Key}/ - {Model.Board.Name}")</h2>

<p class="switcher" tabindex="0" id="switcher" onclick="switchFormVisibility()" data-switched-text="@Localizer["Hide form"]">@Localizer["Create thread"]</p>

<div class="creation-form" id="form">
    <div class="preview-container">
        <div>
            <img id="preview-img" class="preview-imgage" />
        </div>
    </div>
    <form class="posting-form" id="posting-form" method="post" enctype="multipart/form-data" asp-action="CreateThread" asp-controller="Board">
        <input type="hidden" value="@Model.Board.Key" asp-for="OpPost.Board" autocomplete="off" />
        <div class="form-row theme-row">
            <label asp-for="OpPost.Subject">@Localizer["Subject"]</label>
            <input asp-for="OpPost.Subject" autocomplete="off" />
        </div>
        <div class="form-row">
            <textarea class="form-control" rows="4" id="form-msg" asp-for="OpPost.Text"></textarea>
        </div>
        <div class="form-row">
            <div class="form-button">
                <input class="hidden-input" id="post-img" accept=".gif,.jpg,.png,.jpeg" type="file" asp-for="OpPost.Image" onchange="loadImagePreview(this.files)" />
                <label for="post-img">@Localizer["Image"]</label>
            </div>
            <div class="form-button">
                <input id="form-submit" class="hidden-input" type="submit" />
                <label for="form-submit">@Localizer["Create"]</label>
            </div>
        </div>
        <div class="form-row error-list" asp-validation-summary="All"></div>
    </form>
</div>
<hr />
<div class="threads-container">
    @foreach (var thread in Model.Board.Threads)
    {
        <div class="thread" id="thread-@thread.Id">
            <div class="reclear">
                <partial name="_PostView" model="thread.First()" />
                <div class="to-thread">
                    @if (thread.TotalPostsCount - thread.Count() > 0)
                    {
                        <span>@Localizer["{0} post omited, {1} with image.", thread.TotalPostsCount - thread.Count(), thread.PostsWithImageCount - thread.Count(p => p.ImageId != null)]</span>
                    }
                    <a asp-route="thread" asp-route-board="@Model.Board.Key" asp-route-thread="@thread.Id">[@Localizer["To thread"]]</a>
                </div>
            </div>
            @foreach (var post in thread.Skip(1))
            {
                <partial name="_PostView" model="post" />
            }
        </div>
    }
</div>
